import jpcap.JpcapCaptor;
import jpcap.packet.*;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;

public class AdAnalyzer {
	private HashMap<Integer, String> appNameMap;
	private ArrayList<Packet> packets;
	
	public void readNameMap(String nameMapFileName) {
		try {
			int i = 0;
			FileReader fr = new FileReader(nameMapFileName);
			BufferedReader br = new BufferedReader(fr);
			appNameMap = new HashMap<Integer, String>();
			String str = br.readLine();
			while(str != null) {
				appNameMap.put(new Integer(i), str);
				i++;
				str = br.readLine();
			}
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
	
	public void readCapFile(String capFileName) {
		try {
			while(true){
				Packet packet=captor.getPacket();
				if(packet == null || packet == Packet.EOF) 
					break;
				packets.add(packet);	
			}
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
	
	public void display(Packet p) {
		byte[] header = p.header;
		Integer appNameIndex= new Integer(header[6]);
		System.out.print(appNameIndex + " ");
		if (p instanceof TCPPacket) {
			//System.out.println("TCP");
			System.out.print(((TCPPacket) p).src_ip + ":");
			System.out.print(((TCPPacket) p).src_port + " ");
			System.out.print(((TCPPacket) p).dst_ip + ":");
			System.out.print(((TCPPacket) p).dst_port + " ");
			String appName = appNameMap.get(appNameIndex);
			if(appName != null)
				System.out.print(appName + "\n");
			else
				System.out.print("\n");
		} else
			System.out.print("NON-TCP\n");
	}
}
